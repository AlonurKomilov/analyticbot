[pytest]
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (require external services like DB/Redis)
    performance: Performance and load tests
    security: Security-focused tests
    slow: Slow running tests (>5 seconds)
    external: Tests requiring external services
    webhook: Webhook simulation tests
    payment: Payment flow tests
    analytics: Analytics and metrics tests

pythonpath = .
asyncio_mode = auto
norecursedirs = docs/_archive .venv venv

# Test execution options
addopts = 
    -q
    --strict-markers
    --tb=short
    --cov=apps
    --cov=core
    --cov=infra
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-fail-under=5

# Test discovery
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Warnings configuration
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore:.*unclosed.*:ResourceWarning

# Environment variables for pytest-env plugin
env =
    BOT_TOKEN=123456789:TEST_BOT_TOKEN_FOR_TESTING
    DATABASE_URL=sqlite:///./test_analyticbot.db
    REDIS_URL=redis://localhost:6379/15
    TWA_HOST_URL=https://84dp9jc9-11400.euw.devtunnels.ms/
    STORAGE_CHANNEL_ID=-1001234567890
    ENVIRONMENT=test
    DEBUG=true
    LOG_LEVEL=WARNING
