[importlinter]
root_packages =
    apps
    core
    infra
include_external_packages = False

[contract:core_no_apps_infra]
name = Core must not import apps/infra
type = forbidden
source_modules = core
forbidden_modules =
    apps
    infra

[contract:infra_no_apps]
name = Infra must not import apps
type = forbidden
source_modules = infra
forbidden_modules =
    apps

[contract:apps_composition_roots_only]
name = Apps can only import infra in composition roots (DI containers)
type = forbidden
source_modules =
    apps.api.routers
    apps.api.services
    apps.api.middleware
    apps.bot.handlers
    apps.bot.services
    apps.bot.middlewares
    apps.bot.utils
    apps.bot.adapters
    apps.jobs.tasks
forbidden_modules =
    infra
ignore_imports =
    # Phase 5 approved: DI containers can import infra
    apps.api.di_analytics -> infra
    # Phase 5 approved: Deprecated files (delete Oct 21, 2025)
    apps.api.deps -> infra
    apps.bot.deps -> infra
    apps.bot.middlewares.dependency_middleware -> infra
    # Phase 5 approved: Utility functions
    apps.bot.utils.init_db -> infra
    # Phase 5 approved: Optional features
    apps.shared.performance -> infra
    apps.shared.services.chart_service -> infra

# Note: apps.di.* and apps.mtproto.* are intentionally allowed to import infra
# - apps.di.* are DI containers (composition roots)
# - apps.mtproto.* is an infrastructure adapter layer
# These are excluded from forbidden contracts by not being in source_modules
